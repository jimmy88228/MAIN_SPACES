<template>
    <editorMain :showHeader="false" ref="editorMainRef" pageType="MINE" @on-save="save"></editorMain>
</template>
<script>
import editorMain from "@/components/main-components/custom-page/editor-main";
export default {
    name: "userCenter",
    components: {
        editorMain,
    },
    data(){
      return {
        defaultData: {
          id: 0,
          layout_name: "个人中心",
          layout_type: "MINE",
          setting: {
            backgroundColor: "#efefef",
            backgroundImage: "",
            backgroundRepeat: "",
            backgroundSize: "",
            backgroundPosition: "",
          },
          wx_share_title: "",
          wx_share_img: "",
          get_module: [
            {
              id: 0,
              module_name: "个人中心头部",
              module_type: "USER-HEADER",
              dynamic_setting: {},
              module_data: {},
              setting: {
                backgroundColor: "#fff",
                backgroundImage: "",
                backgroundRepeat: "",
                backgroundSize: "",
                backgroundPosition: "",
                marginTop: 0,
                marginBottom: 10,
                marginLeftRight: 0,
                paddingLeftRight: 0,
                paddingTop: 0,
                paddingBottom: 0,
                is_enable: 1,
                widgetRemark: ""
              },
              sort: 1,
              is_deletable: 0
            },
            {
              id: 0,
              module_name: "个人中心功能",
              module_type: "USER-SERVICE",
              dynamic_setting: {},
              module_data: {
                serviceList: [
                  {
                    code: "SURVEY-RECORD",
                    icon: "https://surveyadmin.innourl.com/v/files/public/SURVEY_INNO/edu/images/custom_page/20220421/1650522456940fcX1Ql.png",
                    is_enable: 1,
                    name: "心理测评记录",
                    tip: "提示",
                    type_name: "心理测评记录"
                  },
                  {
                    code: "USERINFO-EDIT",
                    icon: "https://surveyadmin.innourl.com/v/files/public/SURVEY_INNO/edu/images/custom_page/20220421/1650522467701qKB7Do.png",
                    is_enable: 1,
                    name: "信息编辑",
                    tip: "提示",
                    type_name: "信息编辑"
                  }
                ]  
              },
              setting: {
                backgroundColor: "",
                backgroundImage: "",
                backgroundRepeat: "",
                backgroundSize: "",
                backgroundPosition: "",
                marginTop: 0,
                marginBottom: 10,
                marginLeftRight: 0,
                paddingLeftRight: 0,
                paddingTop: 0,
                paddingBottom: 0,
                is_enable: 1,
                widgetRemark:""
              },
              sort: 2,
              is_deletable: 0
            }
          ],
        }
      }
    },
    methods: {
        loadData() {
            return this.$MainApi
                .viewUserCenter({
                    data: {},
                })
                .then((res) => {
                    if (res.code) {//res.data || 
                        let data = res.data || this.defaultData || {};
                        this.$refs["editorMainRef"] &&
                    this.$refs["editorMainRef"].initData(data);
                    }
                });
        },
        save(detail) {
            detail = JSON.parse(JSON.stringify(detail));
            let compPageInfo = detail.compPageInfo || {};
            let pageCompList = detail.pageCompList || [];
            this.$store.commit("setPageLoading", true)
            return this.$MainApi.saveUserCenter({
                    data: {
                        ...compPageInfo,
                        module_data: pageCompList
                    },
                })
                .then((res) => {
                    if (res.code) {
                        this.$Message.success(res.message || "编辑成功");
                    } else {
                        this.$Message.warning(res.message || "编辑失败");
                    }
                }).finally(()=>{
                  this.$store.commit("setPageLoading", false)
                })
        },
    },
    mounted() {
        this.loadData();
    },
};
</script>

<style>
</style>