function watermark(str) {
  if(!str) return;
  let fontSize = 20, rotate = 45, actualRotate = 20; // 实际角度
  let body = document.body;
  let span = document.createElement('span');
  span.style.fontSize = fontSize + "px";
  span.innerHTML = str;
  span.className = "canvas-watermark-str";
  span.style.display = "inline-block";
  span.style.opacity = 0;
  span.style.position = "absolute";
  span.style.left = "0";
  span.style.left = "0";
  span.style.transform = "translateX(-100%)";
  body.appendChild(span);
  let strL = 20, strT = 10;
  let textW = span.clientWidth + (strL * 4);
  let textH = span.clientHeight;
  let can = document.createElement('canvas');
  can.width = hypotenuse(textW, rotate).b; //画布的宽
  can.height = hypotenuse(textW, rotate).a; //画布的高度
  body.appendChild(can);
  can.style.display='none';
  let cans = can.getContext('2d');
  cans.font = "bold "+ fontSize +"px arial"; //画布里面文字的字体
  cans.textBaseline = 'top'; //画布里面文字的垂直位置
  cans.rotate(-rotate * Math.PI / 180); //画布里面文字的旋转角度
  cans.fillStyle = "rgba(17, 17, 17, 0.50)";//画布里面文字的颜色
  cans.textAlign = 'left'; //画布里面文字的水平位置
  cans.fillText(str, -(textW / 2) + strL, textW / 2 - textH / 2); //画布里面文字的间距比例
  let imgsrc = can.toDataURL("image/png");
  let canvasWatermark = document.getElementsByClassName("canvas-watermark");
  if(canvasWatermark.length > 0){
      canvasWatermark[0].style.background = "url(" + imgsrc + ")";
      return;
  }
  let div = document.createElement("div");
  div.class = "canvas-watermark";
  div.style.zIndex = 2;
  div.style.position =  "absolute";
  div.style.top =  "0px";
  div.style.left =  "0px";
  div.style.right =  "0px";
  div.style.bottom =  "0px";
  div.style.pointerEvents =  "none";
  div.style.overflow = "hidden";
  div.style.opacity = "0.5";
  let translateR = rotate - actualRotate;
  div.innerHTML = "<div style='position: absolute; top: 50%;left: 50%; width: 150%; height: 150%;background: url(" + imgsrc + ");opacity: 0.1; transform:translate(-50%, -50%) rotate(" + translateR + "deg);'></div>";
  document.body.appendChild(div)
}

function hypotenuse(long,angle){
  //获得弧度
  var radian = 2*Math.PI/360*angle;
  return {
      a:Math.sin(radian) * long,//邻边
      b:Math.cos(radian) * long//对边
  };
}

export default {
  watermark,
  hypotenuse
};