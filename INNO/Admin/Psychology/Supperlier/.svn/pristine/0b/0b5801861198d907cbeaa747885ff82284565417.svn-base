<template>
  <hold-layout :isFull="true" class="edit-gauge" isShowFormSave @_cancel="cancel" @_save="save">
    <rewrite-tabs isHideLayout :data="tabList" @changeTab="changeTab" :currTab="curTab">
      <template v-slot:basic>
        <form-view ref="basic" class="box"></form-view>
      </template>
      <template v-slot:report>
        <report ref="report" class="box"></report>
      </template>
      <template v-slot:manager>
        <!-- 题目管理 -->
      </template>
      <template v-slot:dimension> 
        <!-- 维度 -->
      </template>
    </rewrite-tabs>
  </hold-layout>
</template>

<script>
import report from "./report.vue"
import formView from "./form.vue"
export default {
  mixins: [],
  components: {
    report,
    formView
  },
  data() {
    return { 
      pageId:0,
      curTab: "basic",
      tabList:[{
        name:"basic",
        label:"基础信息",
        tabName:"editGauge",
      },{
        name:"report",
        label:"报告建议",
        tabName:"editGauge",
      },{
        name:"dimension",
        label:"量表维度",
        tabName:"editGauge",
      }]
    };
  },
  methods: {
    // init(){
    //     if(!this.pageId)return  
    //     this.getInfoApi('scaleInfo',this.pageId).then(res=>{
    //         let data = res.data||{};
    //         let items = data.items ||{};
    //         let {model_name,instruction,description} = items;
    //         this.formData.model_name = model_name||"";
    //         this.formData.instruction = instruction||"";
    //         this.formData.description = description||""; 
    //     })
    // },
    // getInfoApi(url,id){
    //     return this.$MainApi[url]({
    //         data: {
    //             id: this.pageId,
    //         }, 
    //     })
    //     .then((res) => {
    //         if (res.code) {
    //             return res
    //         }else{
    //             return Promise.reject(res);
    //         }
    //     })
    // },
      changeTab(name) {
          console.log('changeTab',name)
          this.curTab = name;
          this.$refs[this.curTab] && this.$refs[this.curTab].init && this.$refs[this.curTab].init();
      },
      cancel(){
          console.log('cancel');
          this.$router.back();
      },
      save(){
          console.log('save')
          this.$refs.basic.save().then(()=>{
            this.$refs.report.clickSave();
          }).catch(e=>{
            this.curTab = 'basic';
          });
          // this.$refs.formId.validate((valid) => {
          //     if (valid) {
          //         this.scaleUpdate().then(()=>{
          //             this.$refs.report.clickSave();
          //         })
          //     }else{
          //         this.curTab = 'basic';
          //         this.$Message.info("请完善基础信息");
          //     }
          // }) 
    },
  },
  mounted () {
    // this.pageId = parseInt(this.pageQuery.id||0);
    // this.init();
  },
};
</script>

<style lang="less" scoped>
.edit-gauge{
    .box{
        padding-top: 40px;
        height: 100%;
    }
}
</style>
<style lang="less">
.edit-gauge{
    .ivu-tabs{
        height: 100%;
    }
    .ivu-tabs-content{
        height: calc(100% - 52px);
    }
}
</style>