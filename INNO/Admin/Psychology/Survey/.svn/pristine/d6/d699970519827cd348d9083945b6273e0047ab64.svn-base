<template>
  <div>
    <div class="data-range-list">
      <div class="data-range-item bg-1">
        <div class="range-item-tip item-tip">平台用户总量 </div>
        <div class="flex-s-c range-item-cont">
          <img class="range-item-icon" src="@/assets/images/ought_member.png"/>
          <div class="range-item-val">{{totalUserInfo.total_users}}</div>
          <div class="">
            <p class="flex-e-c m-t-10 m-b-10">平台学生累计 {{totalUserInfo.total_student}}</p>
            <p class="flex-e-c m-t-10 m-b-10">平台老师累计 {{totalUserInfo.total_teacher}}</p>
          </div>
        </div>
      </div>
      <div class="data-range-item bg-1">
        <div class="range-item-tip item-tip">平台测评统计</div>
        <div class="flex-s-c range-item-cont">
          <img class="range-item-icon" src="@/assets/images/join_member.png" />
          <div class="range-item-val">{{summaryRecordInfo.rerord_count}}</div>
          <div class="">
            <template>
              <p class="flex-e-c m-t-10 m-b-10" v-if="parseFloat(summaryRecordInfo.last_rand) < 0">较昨日减少 {{summaryRecordInfo.last_rand}}
                <span class="fall m-l-20"></span>
              </p>
              <p class="flex-e-c m-t-10 m-b-10" v-else>较昨日新增 {{summaryRecordInfo.last_rand}}
                <span class="rise m-l-20"></span>
              </p>
            </template>
            <template>
              <p class="flex-e-c m-t-10 m-b-10" v-if="parseFloat(summaryRecordInfo.week_rand) < 0">较上周减少 {{summaryRecordInfo.week_rand}}
                <span class="fall m-l-20"></span>
              </p>
              <p class="flex-e-c m-t-10 m-b-10" v-else>较上周新增 {{summaryRecordInfo.week_rand}}
                <span class="rise m-l-20"></span>
              </p>
            </template>
          </div>
        </div>
      </div>
      <div class="data-range-item bg-1">
        <div class="range-item-tip item-tip">累计排查风险</div>
        <div class="flex-s-c range-item-cont">
          <img class="range-item-icon" src="@/assets/images/ought_member.png" />
          <div class="range-item-val">{{warningRecordInfo.warning_count}}</div>
          <div class="">
            <template>
              <p class="flex-e-c m-t-10 m-b-10" v-if="parseFloat(warningRecordInfo.last_rand) < 0">较昨日减少 {{warningRecordInfo.last_rand}} <span class="rise m-l-20" ></span></p>
              <p class="flex-e-c m-t-10 m-b-10" v-else>较昨日新增 {{warningRecordInfo.last_rand}} <span class="rise m-l-20" ></span></p>
            </template>
            <template>
              <p class="flex-e-c m-t-10 m-b-10" v-if="parseFloat(warningRecordInfo.week_rand) < 0">较上周减少 {{warningRecordInfo.week_rand}} <span class="rise m-l-20" ></span></p>
              <p class="flex-e-c m-t-10 m-b-10" v-else>较上周新增 {{warningRecordInfo.week_rand}} <span class="rise m-l-20" ></span></p>
            </template>
          </div>
        </div>
      </div>
    </div>
    <div class="early-warn-area bg-1">
      <div class="early-warn-tip flex-b-c">
        <div class="early-warn-tip-txt item-tip">各年级风险预警情况</div>
        <div class="flex-s-c">
          <p class="warning flex-s-c m-l-10 m-r-20">预警</p>
          <p class="healthing flex-s-c m-l-5 m-r-10">健康</p>
        </div>
      </div>
      <div class="early-warn-list">
        <div class="early-warn-item flex-s-c" v-for="(item, index) in cockpitDataView" :key="index">
          <div class="warn-item-txt f-shrink-0">{{item.gradeName}}</div>
          <div class="warn-item-percen">
            <div class="percen-bg"><span :style="'width: ' + setPercent(item.totalHealth) + ';'" class="percen-rate health-rate"></span></div>
            <div class="percen-bg"><span :style="'width: ' + setPercent(item.totalWarn) + ';'" class="percen-rate warn-rate"></span></div>
          </div>
          <div class="warn-item-percen-val f-shrink-0">{{setPercent(item.totalHealth, 1)}} / {{setPercent(item.totalWarn, 1)}}</div>
        </div>
        <div class="empty-report" v-if="!cockpitDataView || cockpitDataView.length == 0">暂无数据</div>
      </div>
    </div>
  </div>
</template>

<script>
import dataSort from "./data-sort.js";
export default {
  props: {
    totalUserInfo: {
      type: Object,
      default(){
        return {}
      }
    },
    summaryRecordInfo: {
      type: Object,
      default(){
        return {}
      }
    },
    warningRecordInfo: {
      type: Object,
      default(){
        return {}
      }
    },
    groupReportInfo: {
      type: Object,
      default(){
        return {}
      }
    },
    cockpitData:{
      type: Array,
      default(){
        return []
      }
    },
  },
  data(){
    return {
      cockpitDataView: [],
      totalUser: 0
    }
  },
  watch: {
    cockpitData:{
      handler(nV){
        if(nV instanceof Array){
          let gradeJson = [], gradeData = [], totalUser = 0;
          for(let i = 0; i < nV.length; i++){
            let item = nV[i] || {};
            let grade_name = item.grade_name || '未知年级';
            let gradeIndex = gradeJson.indexOf(grade_name);
            if(gradeIndex == -1){
              gradeJson.push(grade_name);
              gradeData.push({
                totalWarn: 0,
                totalHealth: 0,
                totalUser: 0,
                gradeName: grade_name,
              })
              gradeIndex = gradeData.length - 1;
            }
            gradeData[gradeIndex].totalWarn += parseInt(item.warning_male) + parseInt(item.warning_female);
            gradeData[gradeIndex].totalHealth += parseInt(item.health_male) + parseInt(item.health_female);
            gradeData[gradeIndex].totalUser += parseInt(item.male_users) + parseInt(item.female_users);
            // 总人数
            totalUser += parseInt(item.male_users) + parseInt(item.female_users);
          }
          try {
            gradeData.sort((a, b)=>{
              return dataSort.gradeOrder.indexOf(a.gradeName) - dataSort.gradeOrder.indexOf(b.gradeName); // 比较中文排序
            })
          } catch (error) {}
          this.totalUser = totalUser;
          this.cockpitDataView = gradeData;
        }
      },
      immediate: true,
      deep: true
    }
  },
  methods:{
    setPercent(val, fixed = 2){
      return ((val / this.totalUser) * 100).toFixed(fixed) + '%'
    }
  }
}
</script>

<style lang="less" scoped>

.data-range-item {
    padding: 27px 20px 20px 55px;
    color:#fff;
    border-top-right-radius: 30px;
  }
.range-item-tip{}
.range-item-val{
  margin: 0px 10px 0px 12px;
  font-size: 30px;
  font-family: Futura;
  font-weight: normal;
  color: #FFFFFF;
  line-height: 42px;
  min-width: 124px;
}
.range-item-icon{
  width: 34px;
  height: 34px;
  display: block;
  border-radius: 100%;
  background-color:#efefef;
}
.early-warn-area{
    padding: 35px 40px 40px 40px;
    border-top-right-radius: 30px;
  }
  .early-warn-tip{
    color:#fff;
  }
  .early-warn-tip-txt{}
  .early-warn-list{
    padding: 20px 0px;
  }
  .early-warn-item{
    display: flex;
    padding: 10px 0px;
    color:#fff;
  }
  .warn-item-txt{
    min-width: 70px;
  }
  .warn-item-percen-val{
    min-width: 100px;
    text-align: right;
  }
  .warn-item-percen{
    width: 0px;
    flex: 1;
    height: 8px;
    display: flex;
    background-color:#282C4A;
  }
  .percen-bg{
    flex: 1;
    height: 100%;
    position: relative;
  }
  .percen-rate{
    display: inline-block;
    height: 100%;
    position: absolute;
  }
</style>