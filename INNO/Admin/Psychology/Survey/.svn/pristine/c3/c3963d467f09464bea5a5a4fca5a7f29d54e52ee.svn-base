<template>
    <editorMain :showHeader="false" :hideBack="true" ref="editorMainRef" pageType="MINE" @on-save="save"></editorMain>
</template>
<script>
import editorMain from "@/components/main-components/custom-page/editor-main";
export default {
    name: "userCenter",
    components: {
        editorMain,
    },
    data(){
      return {
        defaultData: {
          id: 0,
          layout_name: "个人中心",
          layout_type: "MINE",
          setting: {
            backgroundColor: "#efefef",
            backgroundImage: "",
            backgroundRepeat: "",
            backgroundSize: "",
            backgroundPosition: "",
          },
          get_module: [
            {
              id: 0,
              module_name: "个人中心头部",
              module_type: "USER-HEADER",
              dynamic_setting: {},
              module_data: {},
              setting: {
                backgroundColor: "#FFFFFF",
                backgroundImage: "https://surveyadmin.innourl.com/v/files/public/edu/SURVEY_INNO/images/custom_page/20220609/1654763092916CW0dBh.jpeg",
                backgroundRepeat: "",
                backgroundSize: "",
                backgroundPosition: "top",
                marginTop: 0,
                marginBottom: 10,
                marginLeftRight: 0,
                paddingLeftRight: 0,
                paddingTop: 0,
                paddingBottom: 0,
                is_enable: 1,
                widgetRemark: ""
              },
              sort: 1,
              is_deletable: 0
            },
            {
              id: 0,
              module_name: "个人中心功能",
              module_type: "USER-SERVICE",
              dynamic_setting: {},
              module_data: {
                serviceList: [
                  {
                    code: "SURVEY-RECORD",
                    icon: "https://psyimage.innourl.com/v/admintmp/admin/edu/general/static/user/SURVEY-RECORD.png",
                    is_enable: 1,
                    name: "心理测评记录",
                    tip: "提示",
                    type_name: "心理测评记录"
                  },
                  {
                    code: "BIND-INFO",
                    icon: "https://psyimage.innourl.com/v/admintmp/admin/edu/general/static/user/USERINFO-EDIT.png",
                    is_enable: 1,
                    name: "绑定信息",
                    tip: "提示",
                    type_name: "绑定信息"
                  },
                  {
                    code: "MY-SUBSCRIBE",
                    icon: "https://psyimage.innourl.com/v/admintmp/admin/edu/general/static/user/MY-SUBSCRIBE.png",
                    is_enable: 1,
                    name: "我的预约",
                    tip: "提示",
                    type_name: "我的预约"
                  },
				          {"code":"COURSE-TASK","icon":"https://psyimage.innourl.com/v/admintmp/admin/edu/general/static/user/MY-COURSE.png","is_enable":1,"name":"课程任务","tip":"提示","type_name":"课程任务"}

                ]  
              },
              setting: {
                backgroundColor: "",
                backgroundImage: "",
                backgroundRepeat: "",
                backgroundSize: "",
                backgroundPosition: "",
                marginTop: 0,
                marginBottom: 10,
                marginLeftRight: 0,
                paddingLeftRight: 0,
                paddingTop: 0,
                paddingBottom: 0,
                is_enable: 1,
                widgetRemark:""
              },
              sort: 2,
              is_deletable: 0
            }
          ],
          wx_share_img: "",
          wx_share_title: null
        }
      }
    },
    methods: {
        loadData() {
            return this.$MainApi
                .viewUserCenter({
                    data: {},
                })
                .then((res) => {
                    if (res.code) {
                        let data = res.data || this.defaultData || {};
                        // console.log('数据',data.get_module[1].module_data);  
                        // data.get_module[1].module_data= JSON.stringify();
                        this.$refs["editorMainRef"] && this.$refs["editorMainRef"].initData(data);
                    }
                });
        },
        save(detail) {
            detail = JSON.parse(JSON.stringify(detail));
            let compPageInfo = detail.compPageInfo || {};
            let pageCompList = detail.pageCompList || [];
            this.$store.commit("setPageLoading", true)
            return this.$MainApi.saveUserCenter({
                    data: {
                        ...compPageInfo,
                        module_data: pageCompList
                    },
                })
                .then((res) => {
                    if (res.code) {
                        this.$Message.success(res.message || "编辑成功");
                        this.loadData();
                    } else {
                        this.$Message.warning(res.message || "编辑失败");
                    }
                }).finally(()=>{
                  this.$store.commit("setPageLoading", false)
                })
        },
    },
    mounted() {
        this.loadData();
    },
};
</script>

<style>
</style>