<template>
  <view class="report-info" v-if="hasData">
    <image class="report-background" :src="staticAddress+'/report-info-background-a.png'" mode="scaleToFill" />
    <page-nav :isTransparent="true"></page-nav>
    <view class="report-area relative p-l-25 p-r-25 p-b-32">
      <view class="">
        <view class="flex-b-s m-r-13 m-l-13 p-b-38">
          <view class="">
            <view class="report-title font-24 m-b-20">测评活动</view>
            <view class="font-38 C_333 m-b-15 clamp2 bold" style="width: 100%">{{
              analyze.activityName
            }}</view>
            <view class="font-22 C_7f">测评时间 {{ formatDate(analyze.completeTime) }}</view>
          </view>
        </view>
      </view>
      <view class="evaluation-report">
        <view class="evaluation-score">
          <view class="flex-b-c evaluation-score-info">
            <view class="flex1">
              <view class="C_fff font-80">{{ ruleInfo.coefficientPoints }}<text
                  class="m-l-15 font-26">{{ ruleInfo.pointType }}</text></view>
              <view class="font-24 C_84c7ff clamp2 flex1" style="">{{ruleInfo.rangeShortDesc}}</view>
            </view>
            <image class="f-shrink-0" :src="staticAddress+'/report-info-heart.png'" mode="scaleToFill" />
          </view>
          <view class="evaluation-score-progress">
            <view class="scale">
              <view v-for="(item,i) in rangeList" :key="i" :style="{width:item.percent}">
                <view class="font-20 C_fff m-l-10">{{item.rangeName}}</view>
                <view class="progress_scale_item" :style="item.selected ? `background-color:${item.style}`:''"></view>
              </view>
              <view class="scale-ball" :style="{left:coefficientPercent}">
                <view :style="{'background-color':ballColor}"></view>
              </view>
            </view>
          </view>
        </view>
        <view class="evaluation-description">
          <view class="evaluation-description-title bold font-32">
            <image :src="staticAddress+'/report-info-background-a-tips.png'" mode="scaleToFill" />
            <view>报告评价</view>
          </view>
          <view class="evaluation-description-detail C_50 font-28">
            <text>{{ruleInfo.rangeDescription}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>
</template>

<script>
  import LoadingView from "@/components/css3/loading/loading.vue";
  const pageOption = Page.BasePage({
    name: "report-info-component-b",
    components: {
      LoadingView,
    },
    props: {
      analyze: {
        type: Object,
        default: false
      },
      hasData: {
        type: Boolean,
        default: false
      }
    },
    data() {
      return {
        coefficientPercent: "0%",
        ballColor: "#32B924"
      };
    },
    computed: {
      ruleInfo() {
        let analyze = this.analyze || [];
        let ruleInfo = analyze.ruleList ? analyze.ruleList[0] : {}
        return ruleInfo
      },
      rangeList() {
        let analyze = this.analyze;
        let rangeList = analyze.rangeList ? analyze.rangeList : [];
        let value = analyze.coefficientPoints;
        let maxValue = analyze.rangeList ? analyze.rangeList[analyze.rangeList.length - 1].maxValue : 0;
        let ballColor = "";
        rangeList.forEach((item, i) => {
          item.percent = (((item.maxValue - item.minValue) / maxValue) * 100).toFixed(1) + "%"
          if (value == 0.0) {
            item.style = "#32B924";
          } else if (value > item.minValue && value <= item.maxValue) {
            item.selected = true;
            switch (i) {
              case 0:
                item.style = "#32B924";
                ballColor = "#32B924"
                break
              case 1:
                item.style = "#3FB9FA";
                ballColor = "#3FB9FA";

                break
              case 2:
                item.style = "#4E3FFA";
                ballColor = "#4E3FFA";

                break
              default:
                item.style = "#F76043";
                ballColor = "#F76043";
                break
            }
          }
          console.log(item, i)
        })
        this.ballColor = ballColor;
        this.coefficientPercent = ((value / maxValue - 0.03) * 100).toFixed(1) + '%'
        console.log(this.coefficientPercent, "百分比")
        return rangeList
      }
    },
    onShow() {},
    onReady() {},
    methods: {
      formatDate(date) {
        return date.slice(0, 10)
      }
    },
  });
  export default pageOption;
</script>

<style lang="scss" scoped>
  .report-info {
    min-height: 100vh;
    background: #F0F7FD;

    .report-background {
      position: absolute;
      width: 100%;
      height: 520rpx;
    }

    .report-area {
      margin-top: 50rpx;

      .report-title {
        width: 123rpx;
        color: #06509B;
        padding: 8rpx 0;
        background: rgba($color: #CCE1F4, $alpha: 45);
        border-radius: 8rpx;
        text-align: center;
      }

      .report-info-icon {
        position: absolute;
        right: 0rpx;
        top: -205rpx;
        width: 184rpx;
        height: 191rpx;
        margin-top: 21rpx;
        flex-shrink: 0;
        z-index: 1;
      }

      .analyze-item {
        border-radius: 20rpx;
        background: #ffffff;

        &>view:nth-child(3) {
          line-height: 42rpx;
        }
      }

      .evaluation-report {
        border-radius: 30rpx;
        background-color: #FFFFFF;
        overflow: hidden;

        .evaluation-score {
          width: 100%;
          min-height: 405rpx;
          background: linear-gradient(180deg, #0E4D9A 0%, #2084CA 80%, #F9FCFE 100%);

          .evaluation-score-info {
            padding: 30rpx 45rpx;

            image {
              width: 201rpx;
              height: 154rpx;
            }
          }

          .evaluation-score-progress {
            background-color: #1665AF;
            width: 100%;
            height: 187rpx;
            border-radius: 20rpx 20rpx 0 0;
            display: flex;
            align-items: center;
            justify-content: center;

            .scale {
              width: 90%;
              display: flex;
              position: relative;

              &>view {
                height: 80rpx;
                border-left: 2rpx solid #519ED3;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
              }

              &>view:nth-last-child(2) {
                border-right: 2rpx solid #519ED3;
              }

              .progress_scale_item {
                background-color: rgba($color: #8BBADB, $alpha: 0.2);
                height: 15rpx;
                width: 100%;
              }

              .scale-ball {
                position: absolute;
                bottom: -10rpx;
                left: -0.3%;
                width: 36rpx;
                height: 36rpx;
                background: #FFFFFF;
                border-radius: 50%;
                border: none;
                // transition: 1s all ease-in-out;
                &>view {
                  position: absolute;
                  left: 50%;
                  top: 50%;
                  transform: translate(-50%,-50%);
                  width: 20rpx;
                  height: 20rpx;
                  border-radius: 50%;
                }
              }
            }
          }
        }

        .evaluation-description {

          .evaluation-description-title {
            display: flex;
            align-items: center;
            padding: 50rpx 20rpx 38rpx;
            color: #1665AF;

            image {
              width: 38rpx;
              height: 32rpx;
              margin-right: 13rpx;
            }
          }

          .evaluation-description-detail {
            padding: 0 40rpx 80rpx;
            line-height: 60rpx;
          }
        }
      }
    }
  }
</style>