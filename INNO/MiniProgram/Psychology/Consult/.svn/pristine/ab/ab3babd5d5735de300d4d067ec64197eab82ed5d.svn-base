<template>
  <view>
    <custom-page v-if="!empty" :navIsTransparent="true" :navFull="true" :holdNav="true" ref="customPageRef"></custom-page>
    <view v-else class="global-empty"></view>
  </view>
</template>

<script>
const app = getApp();
const pageOption = Page.BasePage({
  data() {
    return {
      options: {},
      empty:false,
    };
  },
  onLoad(options) {
    this.options = options || {};
  },
  methods: {
    init(){
      let options = this.options||{};
      let page_id = options.page_id || 0;
      let getData = null;
      if(page_id>0){
        getData = ()=>this.getPageDetail(page_id);
      }else if(options.type == 'psycHandbook'){ 
        getData = ()=>this.getPsycHandbook();
      };
      getData && getData().then(res=>{
        if (res.code == 1) {
          let data = res.data || {};
          this.$refs["customPageRef"].initData(data);
        }
      }).catch(e=>{
        setTimeout(() => {
          this.backAction();
        }, 1500);
      })
    },
    getPageDetail(pageId) {
      return this.$Http(this.$Apis.getTargetDetail, {
        data: {
          pageId
        },
        other: {
          isShowLoad: true,
        },
      })
      // .then((res) => {
      //   if (res.code == 1) {
      //     let data = res.data || {};
      //     this.$refs["customPageRef"].initData(data);
      //   }
      // })
      // .catch((err) => {
      //   setTimeout(() => {
      //     this.backAction();
      //   }, 1500);
      // });
    },
    getPsycHandbook(){
      return this.$Http(this.$Apis.getPsycHandbook, {
        data: {}, 
      })
    },
  },
  onShow() {
    this._checkLogin().then((login) => {
      if (!login) return;
      this.init();
    });
  },
});
export default pageOption;
</script>

<style lang="scss">
</style>
