<template>
	<view>

		<scroll-view class="list-scroll-content" :style="{height:scrollHeight + 'px'}" scroll-y @scrolltolower="loadData">
			<u-cell-group v-if="orderList.length > 0">
				<u-cell-item v-for="(item,index) in orderList" :key="index" :arrow="false" :title-width="750">
					<view slot="title" class="title-box">
						<u-row gutter="16">
							<u-col :span="8">
								{{item.order_sn}}
							</u-col>
							<u-col :span="4">
								<u-tag :text="item.order_status_name" size="mini" :type="item.order_status_color" style="margin-right:10rpx;"></u-tag>
								<u-tag :text="item.pay_status_name" size="mini" :type="item.pay_status_color"></u-tag>
							</u-col>
						</u-row>
						<view>
							<text>订单金额：￥{{item.goods_amount}}</text>
							<text v-if="item.store_name != null && item.store_name != '' " style="margin-left: 16rpx;">店铺：{{item.store_name}}</text>
						</view>
					</view>
					<view slot="label" class="clamp label-box">
						<view>
							<u-row v-if="item.order_message != null" 
							v-for="(goods, gindex) in item.order_message" :key="gindex"
							gutter="16"
							style="position: relative;">
								<u-col :span="2">
									<u-avatar :src="goods.goods_thumb" mode="square" size="80"></u-avatar>
								</u-col>
								<u-col :span="10">
									<view class="clamp">{{goods.goods_name}}</view>
									<view>{{goods.goods_attr}} ￥{{goods.goods_price}}</view>
									<view style="position: absolute;right:10rpx;font-weight: bold;bottom:20rpx;">X {{goods.goods_number}}</view>
								</u-col>
							</u-row>
						</view>
						<view style="line-height: 1.5;">{{item.created_at_format}}</view>
					</view>
				</u-cell-item>
			</u-cell-group>
			
			<!-- 空白页 -->
			<u-empty v-if="orderList.length === 0" 
			text="暂无订单" 
			mode="order" 
			:style="{height: scrollHeight+'px'}"></u-empty>
		</scroll-view>
	</view>
</template>

<script>
/**
 * 客服 - 用户订单列表
 */	
export default {
	name: "csUserOrderList",
	components:{
	},
	props:{
		scrollHeight:{
			type:Number,
			default:500,
		}
	},
	data() {
		return {
			orderList:[],
			orderTotal: 0,
			orderPageSize: 20,
			orderCurrPage: 1,
			
			// 会话详情
			sessInfo:{},
		}
	},
	methods:{
		// 提供给父组件调用
		init( sessInfo ){
			this.sessInfo = sessInfo;
			
			this.loadData();
		},
		// 加载用户相关订单
		loadData( currPage = 0 ){
			this.orderCurrPage = currPage > 0 ? currPage : this.orderCurrPage;
		
			this.$u.post( this.$api.orderList, {
				user_id: this.sessInfo.user_id, 
				pageSize: this.orderPageSize,
				page: this.orderCurrPage,
			})
			.then( (response) => {
				var res = response.data;
				if( res.code ){
					this.orderList = res.data.items;
					this.orderTotal = res.data.total;
				}
			});
		},
	},
}
</script>

<style lang="scss">
</style>	