<template>
  <view class="reserve-supervise">
    <page-nav>
      <template slot="title">
        <view>预约督导</view>
      </template>
    </page-nav>
    <view class="form-list">
      <view class="input-panel flex-s-c">
        <view class="input-title">姓名</view>
        <view class="flex1">{{formData.userName}}</view>
      </view>
      <view class="input-panel flex-s-c">
        <view class="input-title">联系方式</view>
        <input class="flex1" type="number" maxlength="11" v-model="formData.phoneNumber">
      </view>
      <ori-picker @pickerChange="(e) => pickerChange(e, 'superviseType')" range-key="serviceName" mode="selector"
        :range="superviseTypeGroup" :pickerValue="superviseTypeValue">
        <template v-slot:content>
          <view class="input-panel flex-b-c">
            <view class="flex flex1">
              <view class="input-title">督导方式</view>
              <view class="flex1">{{superviseTypeGroup[superviseTypeValue].serviceName || ''}}</view>
            </view>
            <view class="font-26 m-l-13 C_80abae">
              选择
            </view>
          </view>
        </template>
      </ori-picker>
      <ori-picker @pickerChange="(e) => pickerChange(e, 'consultDirection')" range-key="consultName" mode="selector"
        :range="consultDirectionGroup" :pickerValue="consultDirectionValue">
        <template v-slot:content>
          <view class="input-panel flex-b-c">
            <view class="flex flex1">
              <view class="input-title">咨询方向</view>
              <view class="flex1">{{consultDirectionGroup[consultDirectionValue].consultName || ''}}</view>
            </view>
            <view class="font-26 m-l-13 C_80abae">
              选择
            </view>
          </view>
        </template>
      </ori-picker>
      <view class="text-area-input">
        <view class="C_7f font-28 m-b-30">是否有其他提问/想说的话</view>
        <textarea placeholder="请在此输入" v-model="formData.remark" placeholder-style="color:#DDDDDD;"
          maxlength="200"></textarea>
      </view>
    </view>
    <view class="bottom-area flex-c-c">
      <view class="submit-button flex-c-c font-30" @click="submitForm">
        提交
      </view>
    </view>
  </view>
</template>

<script>
  import oriPicker from "@/components/ori-comps/picker/ori-picker.vue";
  import SMH from "@/common/helper/show-msg-handler.js";

  const app = getApp();
  const pageOption = Page.BasePage({
    data() {
      return {
        formData: {
          userName: "谢海树",
          phoneNumber: "13545545687",
          serviceId: "",
          consultId: "",
          remark: ""
        },
        superviseTypeGroup: [{
            serviceName: "面谈",
            value: 0
          },
          {
            serviceName: "语音",
            value: 1
          },
          {
            serviceName: "电话",
            value: 2
          }
        ],
        consultDirectionGroup: [{
            consultName: "家庭纠纷",
            value: 0
          },
          {
            consultName: "情绪压力",
            value: 1
          }
        ],
        superviseTypeValue: -1,
        consultDirectionValue: -1
      }
    },
    components: {
      oriPicker,
    },
    methods: {
      init() {
        let userInfo = app.IM.authUserInfo;
        console.log(userInfo)
        this.$set(this.formData,"userName",userInfo.realName)
        this.$set(this.formData,"phoneNumber",userInfo.mobilePhone)
      },
      pickerChange({
        detail
      }, type) {
        if (type == "superviseType") {
          this.superviseTypeValue = detail.value;
          this.formData.serviceId = String(this.superviseTypeGroup[this.superviseTypeValue].value) || "";
        }
        if (type == "consultDirection") {
          this.consultDirectionValue = detail.value;
          this.formData.consultId = String(this.consultDirectionGroup[this.consultDirectionValue].value) || "";
        }
      },
      checkForm() {
        let msg = "";
        let formData = this.formData;
        if (String(formData.phoneNumber).trim().length == 0) {
          msg = "请输入联系方式"
        } else if (!/^1[123456789]\d{9}$/.test(formData.phoneNumber)) {
          msg = "请输入正确的联系方式"
        } else if (!formData.serviceId) {
          msg = "请选择督导方式"
        } else if (!formData.consultId) {
          msg = "请选择咨询方向"
        }
        if (msg) {
          SMH.showToast({
            title: msg,
          });
          return false
        } else {
          return true
        }

      },
      submitForm() {
        if(this.checkForm()){
         
        }
      }
    },
    onShow() {
      this.init()
    },
    onReady() {

    }
  })
  export default pageOption
</script>

<style lang="scss" scoped>
  .reserve-supervise {
    min-height: 100vh;
    background-color: #F7F7F7;

    .form-list {
      // padding: 30rpx 25rpx calc(env(safe-area-inset-bottom) + 165rpx);
      padding: 30rpx 25rpx 165rpx;

      .input-panel {
        box-sizing: border-box;
        padding: 0 30rpx;
        height: 130rpx;
        background-color: #FFFFFF;
        width: 100%;
        border-radius: 20rpx;
        margin-bottom: 20rpx;
        font-size: 28rpx;

        .input-title {
          width: 110rpx;
          margin-right: 37rpx;
          color: #7f7f7f;
          flex-shrink: 0;
        }
      }

      .text-area-input {
        background-color: #FFFFFF;
        padding: 40rpx 36rpx;
        border-radius: 20rpx;

        textarea {
          width: 100%;
          height: 500rpx;
          resize: none;
          line-height: 37rpx;
        }
      }
    }
  }

  .bottom-area {
    position: fixed;
    bottom: 0;
    left: 0;
    width: 100%;
    height: 140rpx;
    background: #FFFFFF;
    z-index: 2;

    .submit-button {
      background: $uni-main-color;
      color: #FFFFFF;
      width: 660rpx;
      height: 100rpx;
      border-radius: 16rpx;
    }
  }
</style>