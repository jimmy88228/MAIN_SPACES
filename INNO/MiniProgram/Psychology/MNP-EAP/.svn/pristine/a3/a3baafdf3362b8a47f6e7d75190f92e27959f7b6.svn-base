<template>
	<view class="user">
		<custom-page :userInfo="authUserInfo" :hold-nav="true" nav-mode="None" ref="customPageRef"></custom-page>
	</view>
</template>

<script>
	const app = getApp();
	const pageOption = Page.BasePage({
		data() {
			return {
				imgUser:'',
				authUserInfo: {}
			}
		},
		// onShareAppMessage(e){},
		methods: {
			reFreshInfo(){
				this._getUserInfo().then(res=>{
					res.profilePicture = res.profilePicture || '' 
					this.authUserInfo = res;
				})
			},
			getMinePageDetail(){
				return this.$Http(this.$Apis.getMinePageDetail,{
				  other:{
				    isShowLoad: true
				  }
				}).then(res=>{
				  if(res.code == 1){
				    let data = res.data || {};
				    this.$refs["customPageRef"].initData(data);
				  }
				})
			},
		},
		onShow(){
			this._checkLogin().then(()=>{
				this.reFreshInfo();
			})
			this.getMinePageDetail();
		},
		onReady(){
			this.$EventBus.$on('onChooseAvatar',(res)=>{
				console.log(res,3333)
				this.authUserInfo.profilePicture = res.res.data

			})
		}
	})
	export default pageOption 
</script>

<style lang="scss" scoped>
</style>
