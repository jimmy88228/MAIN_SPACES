<template>
	<view>
		<u-popup v-model="showPopup" mode="bottom" closeable>
			<view class="avatar-box">
				<view style="width:70rpx;">
					<u-avatar :src="sessInfo.get_user_info.wx_avatar" mode="square" size="60"/>
				</view>
				<view style="flex:1 1 0%;">
					<view class="font-sm">{{sessInfo.get_user_info.wx_nick_name}}</view>
					<view class="font-sm">{{sessInfo.get_user_info.mobile != null ? sessInfo.get_user_info.mobile : '暂无手机号'}}</view>
				</view>
			</view>
			<view class="u-tabs-box" style="border-bottom: 2rpx solid #ddd;">
				<u-tabs-swiper
				activeColor="#007aff" 
				ref="tabs" 
				:list="navList" 
				:current="current" 
				:is-scroll="false" 
				:font-size="26"
				:bar-height="6"
				:height="80"
				bg-color="#f8f8f8"
				swiperWidth="750"
				@change="onTabChange">
				</u-tabs-swiper>
			</view>
			
			<swiper :current="swiperCurrent" class="swiper-box"
			:style="{height:scrollHeight + 'px'}"
			@transition="transition" 
			@animationfinish="animationfinish">
				<swiper-item class="swiper-item">
					<!--用户基本信息-->
					<csUserInfoBasic ref="cs-user-info-basic" :scrollHeight="scrollHeight"></csUserInfoBasic>
				</swiper-item>
				<swiper-item class="swiper-item">
					<!--用户订单列表-->
					<csUserOrderList ref="cs-user-order-list" :scrollHeight="scrollHeight"></csUserOrderList>
				</swiper-item>
				<swiper-item class="swiper-item">
					<!--聊天内容搜索-->
					<csContentSearch ref="cs-content-search" :scrollHeight="scrollHeight" @on-close="showPopup= false"></csContentSearch>
				</swiper-item>
			</swiper>
			
		</u-popup>
	</view>
</template>

<script>
import csUserOrderList from './cs-user-order-list.vue';
import csUserInfoBasic from './cs-user-info-basic.vue';
import csContentSearch from './cs-content-search.vue';
	
/**
 * 客服 - 用户信息组件
 */	
export default {
	name: "csUserInfo",
	components:{
		csUserOrderList,
		csUserInfoBasic,
		csContentSearch,
	},
	data() {
		return {
			showPopup: false,
			
			// 会话详情
			sessInfo:{
				get_user_info:{}
			},
			
			current: 0,
			swiperCurrent: 0,
			scrollHeight: 500,
			
			navList: [
				{name: '基本信息'},
				{name: '关联订单'},
				{name: '内容搜索'},
			],
		}
	},
	mounted(){
		this.init();
	},
	methods:{
		init(){
			// 计算屏幕高度
			var system = uni.getSystemInfoSync();
			this.scrollHeight = system.windowHeight - 90;
		},
		openPopup( sessInfo ){
			this.showPopup = true;
			
			this.sessInfo = sessInfo;
			
			// 加载组件
			this.$nextTick( () => {
				this.$refs['cs-user-order-list'].init( sessInfo );
				this.$refs['cs-user-info-basic'].init( sessInfo );
				this.$refs['cs-content-search'].init( sessInfo );
			});
			
		},
		// tab栏切换
		onTabChange(index) {
			this.swiperCurrent = index;
		},
		// swiper 动画
		transition({ detail: { dx } }) {
			this.$refs.tabs.setDx(dx);
		},
		animationfinish({ detail: { current } }) {
			this.$refs.tabs.setFinishCurrent(current);
			this.swiperCurrent = current;
			this.current = current;
		},
	}	
}
</script>

<style lang="scss">
.title-box{
	line-height: 1;
}
.right-box{
	font-size: $font-base;
	text-align: center;
}	
.avatar-box{
	padding:10rpx 20rpx;
	display: flex;
}
.font-sm{
	font-size: $font-sm;
}
</style>	