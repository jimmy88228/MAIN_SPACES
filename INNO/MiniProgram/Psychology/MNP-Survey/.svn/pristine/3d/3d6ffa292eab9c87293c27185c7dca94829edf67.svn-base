<template>
  <view>
    <template v-if="analyze.reportStyle == 'default'">
      <reportInfoA :analyze="analyze" :has-data="hasData"></reportInfoA>
    </template>
    <template v-else-if="analyze.reportStyle == 'progress'">
      <reportInfoB :analyze="analyze" :has-data="hasData"></reportInfoB>
    </template>
    <template v-else-if="analyze.reportStyle == 'sdq'">
      <reportInfoC :analyze="analyze" :has-data="hasData"></reportInfoC>
    </template>
    <template v-else-if="analyze.reportStyle == 'rutter'">
      <reportInfoRutter ref="reportInfoRutter" :analyze="analyze" :has-data="hasData"></reportInfoRutter>
    </template>
  </view>
</template>

<script>
  import reportInfoA from "@/pages/report/report-info/report-info-component/report-info-component-a.vue"
  import reportInfoB from "@/pages/report/report-info/report-info-component/report-info-component-b.vue"
  import reportInfoC from "@/pages/report/report-info/report-info-component/report-info-component-c.vue"
  import reportInfoRutter from "@/pages/report/report-info/report-info-component/report-info-component-rutter.vue"

  const pageOption = Page.BasePage({
    components: {
      reportInfoA,
      reportInfoB,
      reportInfoC,
      reportInfoRutter
    },
    data() {
      return {
        options: {},
        hasData: false,
        analyze: {},
      };
    },
    onLoad(options) {
      this.options = options;
    },
    onShow() {
      this.loadData();
    },
    onReady() {
    },
    methods: {
      loadData() {
        let recordId = this.options.recordId;
        return this.$Http(this.$Apis.getReportDetail, {
          data: {
            recordId,
          },
          other: {
            showLoading: true,
          },
        }).then((res) => {
          let analyze = res.data || {};
          analyze.adviseModules = this.trans(analyze.adviseModules||[]);
          this.analyze = analyze;
          this.hasData = true; 
          return res;
        });
      },
      trans(data){
        data = data.map(item=>{
          return {
            ...item,
            dynamicSetting:JSON.parse(item.dynamicSetting||'{}'),
            moduleData:JSON.parse(item.moduleData||'{}'),
            setting:JSON.parse(item.setting||'{}'),
          }
        })
        console.log('data',data)
        return data
      }
    },
  });
  export default pageOption;
</script>

<style lang="scss" scoped>

</style>