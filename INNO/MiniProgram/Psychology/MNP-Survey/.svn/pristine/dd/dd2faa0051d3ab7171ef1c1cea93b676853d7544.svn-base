<template>
	<view class="cs-status-setting">
		<u-action-sheet v-model="showSheet" :list="list" :tips="tips" @click="onSelected"></u-action-sheet>	
	</view>	
</template>

<script>
/**
 * 客服人员的状态设置组件
 */	

export default {
	name: 'csStatusSetting',
	data() {
		return {
			showSheet: false,
			
			tips:{
				text: '设置客服人员的状态',
				fontSize: 32
			},
			list:[],
			
			// admin info
			info:{},
		}
	},
	methods: {
		// 提供给父组件使用
		openModal( info ){
			this.info = info;
			
			var list = this.info.statusList;
			for(var i in list){
				list[i]['text'] = list[i].name;
			}
			this.list = list;
			this.showSheet = true;
		},
		// 选中按钮
		onSelected( index ){

			if( this.info != null && typeof( this.info.worker ) != 'undefined' ){

				// 发送状态
				this.$u.post( this.$api.csSetWorkerStatus, {
					status: Number( index )
				})
				.then( (response) => {
					var res = response.data;
					if( res.code ){
						this.info.worker.status = Number( index );
						
						// 客服人员的状态作为标题
						uni.setNavigationBarTitle({
							title: '状态[ '+this.info.statusList[ this.info.worker.status ].name+' ]',
						});
						
						this.$u.toast('状态设置成功');
					}
				});
			}
		}
	}	
}
</script>

<style lang="scss">
.cs-status-setting{
	
}
</style>	