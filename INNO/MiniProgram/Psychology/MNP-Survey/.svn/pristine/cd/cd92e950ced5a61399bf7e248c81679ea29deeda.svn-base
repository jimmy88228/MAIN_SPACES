<template>
  <view class="report-info" v-if="hasData">
    <!-- <view class="report-info"> -->
    <image class="report-background" :src="staticAddress+'/report-info-background-a.png'" mode="scaleToFill" />
    <page-nav :isTransparent="true"></page-nav>
    <view class="report-area relative p-l-25 p-r-25 p-b-32">
      <view class="flex-b-s m-r-13 m-l-13 p-b-38">
        <view class="">
          <view class="report-title font-24 m-b-20">测评活动</view>
          <view class="font-38 C_333 m-b-15 clamp2 bold" style="width: 100%">{{
              analyze.activityName
            }}</view>
          <view class="font-22 C_7f">测评时间 {{ formatDate(analyze.completeTime) }}</view>
        </view>
      </view>
      <view class="report-tips">
        <view class="report-tips-title font-32">
          <view class="C_333 bold">感谢你的参与</view>
          <view class="C_50">阅读本报告时，请注意以下事项：</view>
        </view>
        <view class="tips-info">
          <view class="tips-info-item C_50 font-22" v-for="(item,i) in reportInfoTips" :key="i">
            <view class="tips-info-item-index">{{i+1}}</view>
            <view class="font-22">{{item}}</view>
          </view>
        </view>
      </view>
      <progressReport progressReportStyle="margin-bottom:30rpx" :progressItem="analyze.mainStat"></progressReport>
      <dimension v-for="(item,i) in analyze.dimensionList" :key="i" dimensionStyle="margin-bottom:20rpx"
        :dimensionItem="item"></dimension>
      <progressReport :progressItem="analyze.effectStat">
        <template slot="bottom-content" v-if="ballGroup && ballGroup.length > 0">
          <view>
            <view class="top-splite"></view>
            <view class="personal-perception">
              <view class="evaluation-description-title bold font-32">
                <image :src="staticAddress+'/report-info-background-a-tips.png'" mode="scaleToFill" />
                <view>个人感知概况</view>
              </view>
              <view class="ball-group flex-c-c">
                <view class="ball-item flex-c-c" :style="item.style" v-for="(item,i) in ballGroup" :key="i">
                  <view class="ball-item-content">
                    <view>{{item.ruleName}}</view>
                    <view v-for="(stringItem,stringIndex) in item.optionList" :key="stringIndex">{{stringItem}}</view>
                  </view>
                </view>
              </view>
            </view>
          </view>
        </template>
      </progressReport>
    </view>
  </view>
</template>

<script>
  import LoadingView from "@/components/css3/loading/loading.vue";
  import progressReport from "../report-info-component/module/progress-report.vue";
  import dimension from "../report-info-component/module/dimension.vue";
  const pageOption = Page.BasePage({
    name: "report-info-component-c",
    components: {
      LoadingView,
      progressReport,
      dimension
    },
    props: {
      analyze: {
        type: Object,
        default: false
      },
      hasData: {
        type: Boolean,
        default: false
      }
    },
    data() {
      return {
        dimensionList: [],
        effectStat: [],
        mainStat: [],
        animationBall: {},
        reportInfoTips: [
          '本报告不可作为临床诊断的依据，也不建议把它作为你生活和工作中重大决策的唯一依据；',
          '如报告与你自己的感知有所出入，可能是因为测试时受到了其他因素的影响，或答题时是否有所顾虑。'
        ]
      };
    },
    computed: {
      ruleInfo() {
        let analyze = this.analyze || [];
        let ruleInfo = analyze.ruleList ? analyze.ruleList[0] : {}
        return ruleInfo
      },
      ballGroup() {
        let analyze = this.analyze;
        let selfSenseList = analyze.selfSenseList;
        let maxWidth = "";

        let bigBallList = selfSenseList.filter(item => {
          return item.coefficientPoints >= 6
        })
        if (bigBallList.length >= 3) {
          maxWidth = 100 / selfSenseList.length
        } else {
          maxWidth = 30
        }

        // 2,3->小圈
        // 4,5->中圈 
        // 6,7->大圈 
        selfSenseList.forEach((item, i) => {
          switch (item.coefficientPoints) {
            case 6 || 7:
              item.style =
                `line-height: 30rpx;background-color:rgba(247,96,67,0.7);width:${maxWidth}%;padding-top:${maxWidth}%;font-size:22rpx;`
              break
            case 4 || 5:
              item.style =
              `line-height: 25rpx;background-color:rgba(78,63,250,0.7);width:${maxWidth*190/242}%;padding-top:${maxWidth*190/242}%;font-size:18rpx;`
              break
            case 2 || 3:
              item.style =
              `line-height: 22rpx;background-color:rgba(0, 159, 255, 0.6);width:${maxWidth*126/242}%;padding-top:${maxWidth*126/242}%;font-size:14rpx;`
              break
          }
        })
        return selfSenseList
      }
    },
    onShow() {},
    onReady() {},
    methods: {
      formatDate(date) {
        return date.slice(0, 10)
      },

    },
  });
  export default pageOption;
</script>

<style lang="scss" scoped>
  .report-info {
    min-height: 100vh;
    background: #F0F7FD;

    .report-background {
      position: absolute;
      width: 100%;
      height: 520rpx;
    }

    .report-area {
      margin-top: 50rpx;

      .report-title {
        width: 123rpx;
        color: #5EA6D9;
        padding: 8rpx 0;
        background: rgba($color: #5EA6D9, $alpha: 0.1);
        border-radius: 8rpx;
        text-align: center;
      }

      .report-tips {
        width: 700rpx;
        min-height: 535rpx;
        background: #FFFFFF;
        box-shadow: 0px 9rpx 27rpx 0px rgba(0, 138, 203, 0.15);
        border-radius: 20rpx;
        margin-bottom: 30rpx;

        .report-tips-title {
          padding: 40rpx 45rpx;
          line-height: 55rpx;
        }

        .tips-info {
          padding: 40rpx 35rpx 40rpx 55rpx;
          box-sizing: border-box;
          width: 100%;
          margin-bottom: 40rpx;

          .tips-info-item {
            position: relative;
            padding: 25rpx 30rpx 25rpx 70rpx;
            width: 100%;
            min-height: 129rpx;
            line-height: 40rpx;
            border-radius: 20rpx;
            background: #F3FBFF;
            margin-bottom: 40rpx;
            box-sizing: border-box;

            .tips-info-item-index {
              position: absolute;
              left: -30rpx;
              top: 50%;
              transform: translateY(-50%);
              font-size: 140rpx;
              color: rgba($color: #0083CE, $alpha: 0.2);
            }
          }
        }
      }

      .report-info-icon {
        position: absolute;
        right: 0rpx;
        top: -205rpx;
        width: 184rpx;
        height: 191rpx;
        margin-top: 21rpx;
        flex-shrink: 0;
        z-index: 1;
      }

      .analyze-item {
        border-radius: 20rpx;
        background: #ffffff;

        &>view:nth-child(3) {
          line-height: 42rpx;
        }
      }
    }
  }

  .top-splite {
    border-top: 1px solid rgba($color: #979797, $alpha: 0.1);
    margin: 0 32rpx;


  }

  .personal-perception {

    .evaluation-description-title {
      display: flex;
      align-items: center;
      padding: 50rpx 20rpx 38rpx;
      color: #1665AF;

      image {
        width: 38rpx;
        height: 32rpx;
        margin-right: 13rpx;
      }
    }
  }

  .ball-group {
    width: 100%;
    box-sizing: border-box;
    padding: 20rpx;

    .ball-item {
      flex-shrink: 0;
      height: 0px;
      background-color: rgba($color: #F76043, $alpha: 0.7);
      border-radius: 50%;
      flex-direction: column;
      color: #FFFFFF;
      white-space: nowrap;
      margin: 0px -10rpx;
      position: relative;

      .ball-item-content {
        position: absolute;
        left: 50%;
        top: 50%;
        transform: translate(-50%, -50%);
        text-align: center;
      }
    }
  }
</style>